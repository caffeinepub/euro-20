{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Fix frontend build/runtime failures and add user-visible error messaging",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Fix the frontend-side root causes of the build/deploy failure so the project can build and deploy successfully on the Internet Computer.",
      "acceptanceCriteria": [
        "A clean build completes without errors.",
        "A deploy completes successfully (no deployment error).",
        "The underlying root cause is fixed (not just suppressed), and the fix is committed in code/config."
      ],
      "file_operations": [
        {
          "path": "frontend/src/shims/processEnv.ts",
          "operation": "create",
          "description": "Add a browser-safe global shim that defines `globalThis.process` and `process.env` with a sane default for `II_URL` (and optional override via `globalThis`), so the production browser bundle does not crash when `process.env.*` is referenced."
        },
        {
          "path": "frontend/src/types/process-env.d.ts",
          "operation": "create",
          "description": "Add TypeScript global type declarations for `process` / `process.env` used by the shim and immutable auth hook so the frontend build typechecks cleanly."
        },
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Ensure the `process.env` shim is imported before any components/hooks can access `process.env.*`, and make the footer link construction safe in environments where `window` may not be available during build-time evaluation."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "Prevent `process is not defined` crashes caused by Node-style env references in the browser bundle while keeping Internet Identity login functional without modifying immutable hooks.",
      "acceptanceCriteria": [
        "The frontend bundle does not throw `process is not defined` (or equivalent) at build time or at runtime.",
        "Internet Identity login flow still works and uses a valid identity provider URL.",
        "No files under `frontend/src/hooks/useInternetIdentity.ts` (immutable) are modified."
      ],
      "file_operations": [
        {
          "path": "frontend/src/shims/processEnv.ts",
          "operation": "modify",
          "description": "Implement/adjust the shim so `process.env.II_URL` resolves to a valid identity provider URL (default to the official Internet Identity URL) and cannot throw at runtime; do not change `frontend/src/hooks/useInternetIdentity.ts`."
        },
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Wire the shim into the app by importing it at the top-level (in a non-immutable file) so the immutable Internet Identity hook can safely read `process.env.II_URL`."
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "Show clear in-app English error messages for authentication/actor initialization failures and streak mutation failures (not console-only).",
      "acceptanceCriteria": [
        "When Internet Identity initialization/login fails, the UI displays a clear English error message (no blank/unclear state).",
        "When actor creation or streak mutations fail, the UI displays a clear English error message and the app remains usable.",
        "Errors are not only logged to the console; the user can see them in-app."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/AuthErrorBanner.tsx",
          "operation": "create",
          "description": "Create a minimal banner/notice component that reads `isLoginError` and `loginError` from `useInternetIdentity()` and renders a clear English message in the UI when authentication initialization/login fails."
        },
        {
          "path": "frontend/src/components/AppHeader.tsx",
          "operation": "modify",
          "description": "Render the new `AuthErrorBanner` in the header area so authentication errors are visible without requiring users to open the console."
        },
        {
          "path": "frontend/src/components/CompleteSectionButton.tsx",
          "operation": "modify",
          "description": "Surface streak mutation failures in-app by rendering a small English error message when `useRecordCompletion()` fails (in addition to any existing toast), while keeping the rest of the app usable."
        },
        {
          "path": "frontend/src/components/StreakPanel.tsx",
          "operation": "modify",
          "description": "Handle streak data loading failures by showing a clear English error state (instead of an unclear/blank panel) when the streak query fails."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Ensure streak-related query/mutation errors are propagated with meaningful English messages (so UI components can display them), without changing immutable auth/actor hooks."
        }
      ]
    }
  ]
}